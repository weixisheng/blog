(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{469:function(a,s,e){"use strict";e.r(s);var v=e(28),t=Object(v.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"http缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http缓存"}},[a._v("#")]),a._v(" HTTP缓存")]),a._v(" "),e("p",[a._v("合理的请求缓存能优化性能！\n缓存分为强缓存和协商缓存")]),a._v(" "),e("h2",{attrs:{id:"浏览器缓存位置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存位置"}},[a._v("#")]),a._v(" 浏览器缓存位置")]),a._v(" "),e("ul",[e("li",[a._v("Service Worker")])]),a._v(" "),e("p",[a._v("让 JS 运行在主线程之外，脱离了浏览器的窗体，常见的有"),e("code",[a._v("离线缓存")]),a._v("、"),e("code",[a._v("消息推送")]),a._v("和"),e("code",[a._v("网络代理")]),a._v("。")]),a._v(" "),e("ul",[e("li",[a._v("Memory Cache")])]),a._v(" "),e("p",[a._v("内存缓存，效率最快，但是存活时间短，当渲染进程结束后，内存缓存就不存在了。")]),a._v(" "),e("ul",[e("li",[a._v("Disk Cache")])]),a._v(" "),e("p",[a._v("磁盘缓存，存取效率比内存缓存慢，存活时间长、存储容量大。")]),a._v(" "),e("p",[a._v("比较大的JS、CSS文件会存到磁盘，反之在内存；内存使用率较高的时候，文件优先进入磁盘。")]),a._v(" "),e("ul",[e("li",[a._v("Push Cache")])]),a._v(" "),e("p",[a._v("推送缓存，HTTP/2的内容。")]),a._v(" "),e("h2",{attrs:{id:"强缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[a._v("#")]),a._v(" 强缓存")]),a._v(" "),e("p",[a._v("不需要发送HTTP请求，通过检查相应的字段判断，HTTP/1.0使用的是Expires，HTTP/1.1使用的是Cache-Control。")]),a._v(" "),e("ul",[e("li",[a._v("Expires")])]),a._v(" "),e("p",[a._v("即过期时间，存在于服务端返回的响应头中，告诉浏览器在这个过期时间之前可以直接从缓存里面获取数据，无需再次请求")]),a._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[a._v("Expires"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Wed"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("07")]),a._v(" Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2021")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("01")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[a._v("GMT")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("表示资源在2021年4月7日01:21:20过期，过期了就需要向服务端发请求。")]),a._v(" "),e("p",[a._v("存在的问题：浏览器和服务器的时间不一致，因此时间就可能不准确。")]),a._v(" "),e("ul",[e("li",[a._v("Cache-Control")])]),a._v(" "),e("p",[a._v("Cache-Control采用过期时长控制缓存，对应的是max-age")]),a._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[a._v("Cache"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Control"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" max"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("age"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3600")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("表示响应在3600秒后失效，也就是一个小时内都可以使用缓存。")]),a._v(" "),e("p",[a._v("max-age还有其他属性")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("public: 客户端和代理服务器都可以缓存\nprivate: 只有浏览器能缓存，中间的代理服务器不能缓存\nno-cache: 跳过当前的强缓存，发送HTTP请求，即直接进入协商缓存阶段\nno-store: 不进行任何形式的缓存\ns-maxage: 类似max-age，但是这个是针对代理服务器的缓存时间\nmust-revalidate: 一旦缓存过期，必须回到资源服务器验证\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("ul",[e("li",[a._v("注意")])]),a._v(" "),e("p",[a._v("当Expires和Cache-Control同时存在的时候，Cache-Control会优先考虑。"),e("br"),a._v("\n强缓存失效了，就会进入协商缓存。")]),a._v(" "),e("h2",{attrs:{id:"协商缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[a._v("#")]),a._v(" 协商缓存")]),a._v(" "),e("p",[a._v("强缓存失效之后，浏览器在请求头中携带相应的缓存tag来向服务器发请求，由服务器根据这个tag，来决定是否使用缓存。")]),a._v(" "),e("ul",[e("li",[a._v("Last-Modified")])]),a._v(" "),e("p",[a._v("即最后修改时间，在浏览器第一次给服务器发送请求后，服务器会在响应头中加上这个字段。\n浏览器接收到后，如果再次请求，会在请求头中携带"),e("code",[a._v("If-Modified-Since")]),a._v("字段，这个字段的值也就是服务器传来的最后修改时间。")]),a._v(" "),e("p",[a._v("服务器拿到请求头中的"),e("code",[a._v("If-Modified-Since")]),a._v("的字段后，会跟这个服务器中该资源的"),e("strong",[a._v("最后修改时间")]),a._v("对比:")]),a._v(" "),e("ol",[e("li",[a._v("如果请求头中的这个值小于最后修改时间，说明是时候更新了。返回新的资源，跟常规的HTTP请求响应的流程一样。")]),a._v(" "),e("li",[a._v("否则返回304，告诉浏览器直接用缓存。")])]),a._v(" "),e("ul",[e("li",[a._v("ETag")])]),a._v(" "),e("p",[a._v("服务器给当前文件的内容的唯一标识，只有内容变动，"),e("code",[a._v("ETag")]),a._v("才会变。\n浏览器接收到"),e("code",[a._v("ETag")]),a._v("的值，会在下次请求时，将这个值作为"),e("code",[a._v("If-None-Match")]),a._v("这个字段的内容，并放到请求头中，然后发给服务器。")]),a._v(" "),e("p",[a._v("服务器接收到"),e("code",[a._v("If-None-Match")]),a._v("后，会跟服务器上该资源的"),e("code",[a._v("ETag")]),a._v("进行对比:")]),a._v(" "),e("ol",[e("li",[a._v("如果两者不一样，说明要更新了。返回新的资源，跟常规的HTTP请求响应的流程一样。")]),a._v(" "),e("li",[a._v("否则返回304，告诉浏览器直接用缓存。")])]),a._v(" "),e("ul",[e("li",[a._v("注意")])]),a._v(" "),e("ol",[e("li",[a._v("在精准度上，"),e("code",[a._v("ETag")]),a._v("优于"),e("code",[a._v("Last-Modified")]),a._v("。 "),e("code",[a._v("ETag")]),a._v(" 是按照内容给资源上标识，因此能准确感知资源的变化。而 "),e("code",[a._v("Last-Modified")]),a._v(" 就不一样了，它在一些特殊的情况并不能准确感知资源变化，主要有两种情况：")])]),a._v(" "),e("div",{staticClass:"language-html line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[a._v("1. 编辑了资源文件，但是文件内容并没有更改，这样也会造成缓存失效。\n2. Last-Modified 能够感知的单位时间是秒， 如果文件在 1 秒内改变了多次，\n那么这时候的 Last-Modified 并没有体现出修改。\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[a._v("在性能上，"),e("code",[a._v("Last-Modified")]),a._v("优于"),e("code",[a._v("ETag")]),a._v("，也很简单理解，"),e("code",[a._v("Last-Modified")]),a._v("仅仅只是记录一个时间点，而 "),e("code",[a._v("ETag")]),a._v("需要根据文件的具体内容生成哈希值。")])]),a._v(" "),e("li",[e("p",[a._v("如果两种方式都支持的话，服务器会优先考虑"),e("code",[a._v("ETag")]),a._v("。")])])])])}),[],!1,null,null,null);s.default=t.exports}}]);